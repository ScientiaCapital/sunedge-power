// Commercial Solar Energy Expert Knowledge Base for Sunny
export const SOLAR_KNOWLEDGE_BASE = {
  companyInfo: `
    SunEdge Power: Commercial Solar Experts Since 2006
    - Specializes in 100kW to 100MW+ systems
    - C&I, Industrial, and Utility-scale focus
    - 500MW+ installed across 12 states
    - Zero lost-time incidents in 5 years
    - 60%+ repeat commercial clients
    - In-house engineering and project management
    - Direct relationships with Tier-1 manufacturers
  `,

  commercialIndustrial: `
    Manufacturing & Industrial Facilities:
    - Energy-intensive operations: 500kW-10MW typical
    - Peak demand reduction: Save 30-50% on demand charges
    - Load shifting strategies for time-of-use rates
    - Power factor correction integration
    - 24/7 operations: Battery backup essential
    - Typical payback: 3-5 years with incentives
    
    Warehouses & Distribution Centers:
    - Large flat roofs: 100,000-1M+ sq ft available
    - Low power density: $0.50-1.00/sq ft savings
    - Refrigerated warehouses: High baseload perfect for solar
    - Loading dock canopies: Additional generation space
    - Fleet charging integration opportunities
    
    Data Centers:
    - Critical load requirements: N+1 redundancy
    - 24/7 baseload: 1-50MW typical demand
    - Sustainability goals: RE100, carbon neutral
    - Microgrid integration for reliability
    - Cooling load optimization with solar
    
    Multi-Tenant Properties:
    - Virtual net metering allocation
    - Common area offset strategies
    - Tenant billing and sub-metering
    - Green building certifications (LEED, Energy Star)
    - Increased property values: 4-7% premium
  `,

  utilityScale: `
    Utility-Scale Development (5MW-500MW+):
    - Site requirements: 6-8 acres per MW
    - Interconnection studies: $100k-1M+ cost
    - Transmission capacity analysis critical
    - Environmental assessments required
    - 18-36 month development timeline
    
    Grid Integration:
    - FERC regulations and compliance
    - ISO/RTO market participation
    - Ancillary services revenue
    - Capacity market opportunities
    - Curtailment risk mitigation
    
    PPA Structuring:
    - Fixed escalator: 1.5-2.5% typical
    - Time-of-delivery factors
    - Basis risk management
    - Green attributes (RECs) handling
    - 15-25 year terms standard
  `,

  advancedFinancing: `
    Commercial Financial Structures:
    - Tax Equity Partnerships: Monetize ITC efficiently
    - Sale-Leaseback: Balance sheet optimization
    - Partnership Flip: Developer retains upside
    - Inverted Lease: Higher sponsor returns
    - Back-leveraged debt: Enhance equity returns
    
    Corporate Procurement:
    - Virtual PPA (VPPA): No physical delivery
    - Direct PPA: On-site or nearby
    - Green Tariffs: Utility programs
    - Community Solar: Shared savings
    - Renewable Energy Credits (RECs)
    
    Financial Metrics:
    - LCOE: $0.03-0.06/kWh typical
    - IRR targets: 8-15% unlevered
    - Debt coverage ratio: 1.3-1.5x
    - Cash-on-cash returns: 6-10%
    - Payback period: 4-8 years
  `,

  commercialBatteryStorage: `
    MW-Scale Storage Systems:
    - Tesla Megapack: 3.9 MWh units, 2hr/4hr configurations
    - Fluence GridStack: 5MW/20MWh+ systems
    - Wartsila GEMS: 10-500MWh deployments
    - Form Energy: 100hr iron-air for long duration
    - ESS Inc: Iron flow batteries, 25-year life
    
    Commercial Applications:
    - Demand Charge Management: 
      * Peak shaving: Reduce 15-minute peaks
      * Typical savings: $50-200/kW-year
      * ROI: 3-7 years standalone
    - Time-of-Use Arbitrage:
      * Buy low ($0.05/kWh) sell high ($0.20+/kWh)
      * 2-4 hour storage optimal
      * Stack with demand reduction
    - Critical Backup:
      * Data centers: 15-30 minutes ride-through
      * Healthcare: 4-24 hour backup
      * Cold storage: Prevent spoilage
    
    Revenue Stacking:
    - Demand reduction: $100-300/kW-year
    - Energy arbitrage: $50-150/kW-year
    - Frequency regulation: $30-100/kW-year
    - Capacity payments: $20-80/kW-year
    - Resiliency value: Priceless
  `,

  commercialEVCharging: `
    Fleet Electrification Solutions:
    - Depot Charging:
      * 50-500 vehicle capacity
      * Smart load management required
      * 1-3MW typical power needs
      * Overnight charging optimization
    - Route Optimization:
      * En-route DC fast charging
      * 150-350kW charge rates
      * 15-45 minute dwell times
      * Strategic placement critical
    
    Commercial Charging Infrastructure:
    - Workplace Charging:
      * 10-50 L2 stations typical
      * 7.2-19.2kW per station
      * Employee attraction/retention
      * $500-2000/station installed
    - Public/Retail Charging:
      * Mix of L2 and DCFC
      * Revenue: $0.20-0.50/kWh markup
      * Increase dwell time 20-60min
      * Federal NEVI funding available
    
    Solar + Storage + EV Integration:
    - Microgrid controller coordination
    - Peak demand management
    - Time-of-use optimization
    - Resilient charging during outages
    - Carbon-free transportation
  `,

  projectDevelopment: `
    Site Assessment Process:
    - Structural Analysis:
      * Live/dead load calculations
      * Wind uplift requirements  
      * Seismic considerations
      * Roof age and condition (<5 years ideal)
    - Electrical Infrastructure:
      * Service capacity analysis
      * Interconnection voltage level
      * Switchgear space requirements
      * Arc flash studies needed
    
    Interconnection Process:
    - Small Commercial (< 1MW):
      * Fast Track process: 2-6 months
      * Simplified studies
      * Lower upgrade costs
    - Large C&I (1-20MW):
      * Detailed studies: 6-18 months
      * System impact study required
      * Potential grid upgrades
    - Utility Scale (20MW+):
      * Full LGIA process: 18-36 months
      * Affected system studies
      * Network upgrades likely
    
    Construction Management:
    - Mobilization: Staging, safety setup
    - Installation rates: 100-500kW/day
    - Quality control: IV testing, torque checks
    - Commissioning: Performance testing
    - Substantial completion: 95% online
  `,

  commercialTechnical: `
    Commercial Equipment Specifications:
    - Modules: 540-700W bifacial standard
    - String Inverters: 60-250kW units
    - Central Inverters: 500kW-4MW
    - Power optimizers for shading
    - Smart combiners with monitoring
    
    Design Considerations:
    - DC:AC ratio: 1.15-1.35 typical
    - Row spacing: 2:1 to 3:1 ratio
    - Tilt angle: Latitude ± 15°
    - Azimuth: 180° (true south) ideal
    - Cable sizing for <2% voltage drop
    
    Performance Guarantees:
    - Year 1: 97% availability minimum
    - Annual degradation: 0.5% max
    - Performance ratio: 80%+ guaranteed
    - Weather-adjusted guarantees
    - Liquidated damages for underperformance
  `,

  operationsMaintenance: `
    Commercial O&M Programs:
    - Preventive Maintenance:
      * Quarterly site inspections
      * Annual IR thermography
      * Torque checks (ground mount)
      * Vegetation management
      * Inverter maintenance
    
    - Performance Monitoring:
      * 24/7 NOC monitoring
      * 4-hour response time
      * Remote diagnostics
      * Automated fault detection
      * Monthly performance reports
    
    - Corrective Maintenance:
      * Module replacement
      * Inverter repairs
      * Tracker maintenance
      * Electrical repairs
      * Emergency response
    
    O&M Pricing:
    - Fixed: $5-10/kW/year
    - Rooftop: $8-15/kW/year
    - Ground mount: $6-12/kW/year
    - Performance guarantee included
  `,

  commercialCalculations: `
    Quick ROI Calculations:
    - Small Commercial (100-500kW):
      * Cost: $2.00-2.50/W installed
      * Savings: $15,000-75,000/year
      * Payback: 5-7 years
      * 25-yr NPV: $200k-1M
    
    - Large C&I (500kW-5MW):
      * Cost: $1.50-2.00/W installed  
      * Savings: $75,000-750,000/year
      * Payback: 4-6 years
      * 25-yr NPV: $1M-10M
    
    - Utility Scale (5MW+):
      * Cost: $0.90-1.50/W installed
      * PPA rate: $30-60/MWh
      * Developer IRR: 8-12%
      * 20-yr revenue: $15M-100M+
    
    Key Metrics by Industry:
    - Manufacturing: $0.08-0.12/kWh savings
    - Cold Storage: $100-200/kW demand savings
    - Data Centers: 1.2-1.5 PUE improvement
    - Warehouses: $0.50-1.00/sq ft value
  `,

  industrySpecific: `
    Manufacturing & Industrial:
    - High energy intensity: 500+ kWh/sq ft/year
    - Demand charges: 30-50% of bill
    - Peak coincidence: 60-80% with solar
    - Process heat integration opportunities
    - 24/7 operations benefit from storage
    
    Healthcare & Hospitals:
    - Critical power requirements
    - Backup power mandates
    - High daytime usage aligns with solar
    - Sustainability goals for community
    - Resilience center capabilities
    
    Education & Universities:
    - Summer peak reduction
    - Student sustainability initiatives  
    - Research partnerships
    - Long-term ownership horizon
    - Multiple funding sources
    
    Retail & Shopping Centers:
    - High HVAC loads match solar
    - Covered parking premium
    - EV charging attracts customers
    - Green marketing opportunities
    - Triple net lease considerations
  `,
};

// Smart response enhancer for context-aware answers
export const enhanceResponse = (userQuery: string): string => {
  const query = userQuery.toLowerCase();
  let additionalContext = SOLAR_KNOWLEDGE_BASE.companyInfo + '\n\n';

  // Industry-specific context
  if (query.includes('manufactur') || query.includes('industrial') || query.includes('factory')) {
    additionalContext +=
      SOLAR_KNOWLEDGE_BASE.industrySpecific + '\n' + SOLAR_KNOWLEDGE_BASE.commercialIndustrial;
  } else if (query.includes('warehouse') || query.includes('distribution')) {
    additionalContext += SOLAR_KNOWLEDGE_BASE.commercialIndustrial;
  } else if (query.includes('data center') || query.includes('datacenter')) {
    additionalContext +=
      SOLAR_KNOWLEDGE_BASE.commercialIndustrial +
      '\n' +
      SOLAR_KNOWLEDGE_BASE.commercialBatteryStorage;
  } else if (
    query.includes('hospital') ||
    query.includes('healthcare') ||
    query.includes('medical')
  ) {
    additionalContext += SOLAR_KNOWLEDGE_BASE.industrySpecific;
  }

  // Technical topics
  if (
    query.includes('utility') ||
    query.includes('utility-scale') ||
    query.includes('solar farm')
  ) {
    additionalContext += SOLAR_KNOWLEDGE_BASE.utilityScale;
  }
  if (
    query.includes('battery') ||
    query.includes('storage') ||
    query.includes('backup') ||
    query.includes('megapack')
  ) {
    additionalContext += SOLAR_KNOWLEDGE_BASE.commercialBatteryStorage;
  }
  if (
    query.includes('ev') ||
    query.includes('electric vehicle') ||
    query.includes('charging') ||
    query.includes('fleet')
  ) {
    additionalContext += SOLAR_KNOWLEDGE_BASE.commercialEVCharging;
  }

  // Financial topics
  if (
    query.includes('cost') ||
    query.includes('price') ||
    query.includes('roi') ||
    query.includes('payback')
  ) {
    additionalContext += SOLAR_KNOWLEDGE_BASE.commercialCalculations;
  }
  if (
    query.includes('financ') ||
    query.includes('ppa') ||
    query.includes('lease') ||
    query.includes('tax')
  ) {
    additionalContext += SOLAR_KNOWLEDGE_BASE.advancedFinancing;
  }

  // Project development
  if (query.includes('develop') || query.includes('interconnect') || query.includes('construct')) {
    additionalContext += SOLAR_KNOWLEDGE_BASE.projectDevelopment;
  }
  if (query.includes('maintenance') || query.includes('o&m') || query.includes('monitor')) {
    additionalContext += SOLAR_KNOWLEDGE_BASE.operationsMaintenance;
  }
  if (query.includes('technical') || query.includes('spec') || query.includes('equipment')) {
    additionalContext += SOLAR_KNOWLEDGE_BASE.commercialTechnical;
  }

  return additionalContext;
};

// Quick calculation functions for Sunny to use
export const calculateQuickROI = (systemSizeKW: number, electricityRate: number = 0.1): object => {
  const annualProduction = systemSizeKW * 1500; // kWh/year
  const annualSavings = annualProduction * electricityRate;
  const systemCost = systemSizeKW * 2000; // $2/W estimate
  const federalTaxCredit = systemCost * 0.3;
  const netCost = systemCost - federalTaxCredit;
  const simplePayback = netCost / annualSavings;

  return {
    systemSize: `${systemSizeKW} kW`,
    estimatedCost: `$${systemCost.toLocaleString()}`,
    federalTaxCredit: `$${federalTaxCredit.toLocaleString()}`,
    netCostAfterITC: `$${netCost.toLocaleString()}`,
    annualSavings: `$${annualSavings.toLocaleString()}`,
    simplePayback: `${simplePayback.toFixed(1)} years`,
    twentyFiveYearSavings: `$${(annualSavings * 25).toLocaleString()}`,
  };
};
